# "找屎"功能测试指南

## 功能概述

"找屎"功能是应用的核心功能，当用户点击"找屎"按钮时，系统会：

1. ✅ **获取当前位置**：请求定位权限并获取用户当前坐标
2. ✅ **位置居中显示**：将当前位置置于地图中心
3. ✅ **搜索附近厕所**：在指定半径内搜索可用厕所
4. ✅ **智能筛选**：根据用户选择的时长和出行方式筛选可达厕所
5. ✅ **路线规划**：使用高德地图API验证路线可达性
6. ✅ **自动导航**：导航到最近的可达厕所

## 测试前准备

### 1. 设备要求
- ✅ 真实设备（地图功能无法在模拟器中测试）
- ✅ 已开启GPS定位服务
- ✅ 网络连接正常
- ✅ 已安装华为地图应用（用于导航）

### 2. 权限确认
- ✅ 精确位置权限
- ✅ 粗略位置权限
- ✅ 网络访问权限

### 3. 配置检查
- ✅ 地图Client ID已配置
- ✅ 高德地图API Key已配置（可选，未配置时使用估算模式）

## 详细测试步骤

### 测试场景1：基本功能测试

#### 步骤1：启动应用
1. 打开应用
2. 等待地图加载完成
3. 确认地图显示正常

**预期结果**：
- 地图正常显示
- 底部显示"找屎"按钮和控制面板
- 时间选择器显示默认值（5分钟）
- 出行方式默认为步行

#### 步骤2：调整参数
1. 点击时间选择器，选择不同时长（2min、5min、10min）
2. 点击出行方式开关，切换步行/骑行模式

**预期结果**：
- 时间选择器响应正常，高亮显示选中时间
- 出行方式开关动画流畅，图标和文字颜色正确变化

#### 步骤3：执行"找屎"功能
1. 点击"找屎"按钮
2. 观察权限请求对话框（如果是首次使用）
3. 授予定位权限
4. 等待定位和搜索完成

**预期结果**：
- 按钮文字变为"定位中..."
- 成功获取当前位置
- 地图相机移动到当前位置
- 在地图上显示"我的位置"标记
- 搜索附近厕所并显示标记
- 自动启动导航到最近厕所

### 测试场景2：权限处理测试

#### 步骤1：权限拒绝测试
1. 卸载并重新安装应用
2. 点击"找屎"按钮
3. 在权限请求对话框中选择"拒绝"

**预期结果**：
- 显示中文提示："需要位置权限才能使用找厕所功能"
- 提供"去设置"按钮
- 应用不会崩溃

#### 步骤2：权限授予测试
1. 点击"去设置"按钮或重新点击"找屎"按钮
2. 授予位置权限
3. 功能正常执行

**预期结果**：
- 成功获取位置并执行后续流程

### 测试场景3：时长筛选测试

#### 步骤1：短时长测试（2分钟）
1. 选择2分钟时长
2. 选择步行模式
3. 点击"找屎"按钮

**预期结果**：
- 只显示2分钟步行可达的厕所
- 如果没有可达厕所，显示"在2分钟内未找到可达厕所"

#### 步骤2：长时长测试（10分钟）
1. 选择10分钟时长
2. 选择骑行模式
3. 点击"找屎"按钮

**预期结果**：
- 显示更多10分钟骑行可达的厕所
- 选择距离最近的厕所进行导航

### 测试场景4：出行方式测试

#### 步骤1：步行模式测试
1. 选择步行模式
2. 选择5分钟时长
3. 执行"找屎"功能

**预期结果**：
- 使用步行速度（约5km/h）计算可达厕所
- 导航提示显示"已为您规划步行路线到..."

#### 步骤2：骑行模式测试
1. 选择骑行模式
2. 选择5分钟时长
3. 执行"找屎"功能

**预期结果**：
- 使用骑行速度（约15km/h）计算可达厕所
- 导航提示显示"已为您规划骑行路线到..."
- 可达厕所数量应比步行模式更多

### 测试场景5：地图交互测试

#### 步骤1：地图点击导航
1. 在地图上任意位置点击
2. 观察导航启动情况

**预期结果**：
- 启动华为地图导航到点击位置
- 使用当前选择的出行方式和时长参数

#### 步骤2：标记点击导航
1. 点击地图上的厕所标记
2. 观察导航启动情况

**预期结果**：
- 启动华为地图导航到该厕所
- 地图相机移动到厕所位置

### 测试场景6：异常情况测试

#### 步骤1：网络异常测试
1. 断开网络连接
2. 点击"找屎"按钮

**预期结果**：
- 定位可能失败，显示"定位超时，请检查网络连接"
- 或使用缓存位置继续执行
- 路线规划回退到估算模式

#### 步骤2：GPS关闭测试
1. 关闭设备GPS
2. 点击"找屎"按钮

**预期结果**：
- 显示定位失败提示
- 应用不会崩溃

#### 步骤3：无厕所数据测试
1. 在偏远地区测试
2. 点击"找屎"按钮

**预期结果**：
- 显示"附近没有找到厕所"
- 应用不会崩溃

## 调试信息检查

在测试过程中，注意观察控制台日志输出：

### 关键日志信息

```
// 权限相关
Index: location permission not granted, requesting permission
Index: location permission granted by user

// 定位相关
Index: getting current location for toilet search
Index: current location obtained: {lat: xx.xxx, lng: xx.xxx}

// 地图相关
Index: centering map to current location
MapKitAdapter: moving camera to: {lat: xx.xxx, lng: xx.xxx}

// 搜索相关
Index: searching toilets with options: {...}
Index: found X toilets nearby

// 路线规划相关
Navigation: planning route with Amap API
RouteService: route planned successfully
Navigation: route validated

// 导航相关
Index: navigating to nearest toilet: {...}
Navigation: Started navigation to xxx with mode WALKING
```

### 错误日志监控

```
// 权限错误
Index: user denied location permission

// 定位错误
Index: handleFindToilet failed - LOCATION_TIMEOUT

// 路线规划错误
RouteService: route planning failed, falling back to estimation

// 导航错误
Navigation: Failed to start Huawei Map navigation
```

## 性能指标

### 响应时间要求
- 权限请求响应：< 1秒
- 定位获取：< 15秒
- 厕所搜索：< 3秒
- 路线规划：< 5秒
- 地图相机移动：< 1秒
- 导航启动：< 2秒

### 用户体验要求
- 按钮状态变化及时
- 加载过程有明确提示
- 错误信息友好易懂
- 操作流程顺畅无卡顿

## 常见问题排查

### 1. 地图不显示
- 检查Client ID配置
- 确认网络连接
- 验证设备兼容性

### 2. 定位失败
- 检查GPS开启状态
- 确认位置权限授予
- 验证网络连接

### 3. 导航不启动
- 确认华为地图应用已安装
- 检查应用权限设置
- 验证目标坐标有效性

### 4. 找不到厕所
- 检查数据提供器实现
- 确认搜索半径设置
- 验证厕所数据完整性

## 测试报告模板

### 测试环境
- 设备型号：
- 系统版本：
- 应用版本：
- 测试时间：
- 测试地点：

### 测试结果
- [ ] 基本功能正常
- [ ] 权限处理正确
- [ ] 时长筛选有效
- [ ] 出行方式切换正常
- [ ] 地图交互响应
- [ ] 异常处理完善

### 发现问题
1. 问题描述：
   - 复现步骤：
   - 预期结果：
   - 实际结果：
   - 严重程度：

### 改进建议
1. 功能改进：
2. 性能优化：
3. 用户体验：

---

**注意**：本功能涉及定位和地图服务，必须在真实设备上进行测试。模拟器和预览器无法提供完整的测试环境。