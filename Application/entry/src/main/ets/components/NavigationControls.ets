/**
 * å¯¼èˆªæ§åˆ¶ç»„ä»¶
 * åŒ…å«æ—¶é—´è°ƒèŠ‚å™¨ï¼ˆæ—¶é’Ÿæ ·å¼ï¼‰å’Œå‡ºè¡Œæ–¹å¼å¼€å…³
 */

import { Callback1, TravelMode } from '../common/types';

// æ—¶é—´é€‰é¡¹ï¼ˆåˆ†é’Ÿï¼‰
export const TIME_OPTIONS = [2, 5, 10];

@Component
export struct NavigationControls {
  @State selectedTime: number = 5; // é»˜è®¤5åˆ†é’Ÿ
  @State travelMode: TravelMode = TravelMode.WALKING; // é»˜è®¤æ­¥è¡Œ
  
  // å›è°ƒå‡½æ•°
  @Prop onTimeChange?: Callback1<number>;
  @Prop onModeChange?: Callback1<TravelMode>;

  build() {
    Row({ space: 20 }) {
      // å·¦ä¾§ï¼šæ—¶é—´è°ƒèŠ‚å™¨ï¼ˆæ—¶é’Ÿæ ·å¼ï¼‰
      this.buildTimeSelector()
      
      // å³ä¾§ï¼šå‡ºè¡Œæ–¹å¼å¼€å…³
      this.buildModeSwitch()
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    .padding({ left: 20, right: 20 })
  }

  @Builder
  buildTimeSelector() {
    Column({ space: 8 }) {
      // æ—¶é’Ÿå›¾æ ‡
      Stack() {
        // å¤–åœ†
        Circle()
          .width(40)
          .height(40)
          .fill('#E8F4FD')
          .stroke('#4C8BF5')
          .strokeWidth(2)
        
        // æ—¶é’ŸæŒ‡é’ˆ
        Column() {
          // æ—¶é’ˆ
          Rect()
            .width(2)
            .height(12)
            .fill('#4C8BF5')
            .margin({ bottom: 2 })
          
          // åˆ†é’ˆ
          Rect()
            .width(1)
            .height(16)
            .fill('#4C8BF5')
        }
        .rotate({ angle: this.getClockAngle() })
      }
      
      // æ—¶é—´é€‰é¡¹
      Row({ space: 8 }) {
        ForEach(TIME_OPTIONS, (time: number) => {
          Text(`${time}min`)
            .fontSize(12)
            .fontColor(this.selectedTime === time ? '#4C8BF5' : '#666666')
            .fontWeight(this.selectedTime === time ? FontWeight.Bold : FontWeight.Normal)
            .padding({ left: 8, right: 8, top: 4, bottom: 4 })
            .backgroundColor(this.selectedTime === time ? '#E8F4FD' : Color.Transparent)
            .borderRadius(12)
            .onClick(() => {
              this.selectedTime = time;
              this.onTimeChange?.handler?.(time);
            })
        })
      }
    }
    .alignItems(HorizontalAlign.Center)
  }

  @Builder
  buildModeSwitch() {
    Column({ space: 8 }) {
      // å¼€å…³æ ·å¼çš„å‡ºè¡Œæ–¹å¼é€‰æ‹©å™¨
      Stack() {
        // èƒŒæ™¯è½¨é“
        Rect()
          .width(80)
          .height(36)
          .fill('#F0F0F0')
          .borderRadius(18)
        
        // æ»‘åŠ¨æŒ‰é’®
        Circle()
          .width(32)
          .height(32)
          .fill('#4C8BF5')
          .shadow({ radius: 4, color: '#1A000000', offsetX: 0, offsetY: 2 })
          .translate({
            x: this.travelMode === TravelMode.WALKING ? -20 : 20
          })
          .animation({
            duration: 200,
            curve: Curve.EaseInOut
          })
      }
      .onClick(() => {
        this.travelMode = this.travelMode === TravelMode.WALKING ? TravelMode.CYCLING : TravelMode.WALKING;
        this.onModeChange?.handler?.(this.travelMode);
      })
      
      // æ¨¡å¼æ ‡ç­¾
      Row({ space: 16 }) {
        // æ­¥è¡Œå›¾æ ‡å’Œæ–‡å­—
        Column({ space: 2 }) {
          Text('ğŸš¶')
            .fontSize(16)
          Text('æ­¥è¡Œ')
            .fontSize(10)
            .fontColor(this.travelMode === TravelMode.WALKING ? '#4C8BF5' : '#999999')
        }
        .opacity(this.travelMode === TravelMode.WALKING ? 1 : 0.6)
        
        // éª‘è¡Œå›¾æ ‡å’Œæ–‡å­—
        Column({ space: 2 }) {
          Text('ğŸš´')
            .fontSize(16)
          Text('éª‘è¡Œ')
            .fontSize(10)
            .fontColor(this.travelMode === TravelMode.CYCLING ? '#4C8BF5' : '#999999')
        }
        .opacity(this.travelMode === TravelMode.CYCLING ? 1 : 0.6)
      }
    }
    .alignItems(HorizontalAlign.Center)
  }

  // æ ¹æ®é€‰æ‹©çš„æ—¶é—´è®¡ç®—æ—¶é’ŸæŒ‡é’ˆè§’åº¦
  private getClockAngle(): number {
    // ç®€å•çš„è§’åº¦è®¡ç®—ï¼Œè®©æŒ‡é’ˆæ ¹æ®æ—¶é—´å˜åŒ–
    return (this.selectedTime * 30) % 360; // æ¯åˆ†é’Ÿ30åº¦
  }
}